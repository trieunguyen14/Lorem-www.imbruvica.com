$(function() {
    window.FastClick = FastClick.attach(document.body);
    document.addEventListener("touchstart", function() {}, true);
    $(document).foundation();
    videojs.options.flash.swf = "bower_components/video.js/dist/video-js/video-js.swf";
    var winW = $(window).width(), subNavIndications = $(".sub-nav .swipe"), home = $("#home"), mainNavSwipes = {};
    var carouselHolder = $("#home .you-i-section");
    function resizeCarouselHolder() {
        if (window.innerWidth > 768) {
            carouselHolder.width("90%").width(carouselHolder.width());
        } else {
            carouselHolder.width("100%");
            if (carouselHolder.width() > 700) {
                carouselHolder.width = 700;
            } else {
                carouselHolder.width(carouselHolder.width());
            }
        }
    }
    $(".unsub-button").click(function () {
        if (!($("#cphMainContent_C015_cbNurseSupport").is(":checked")) &&
        !($("#cphMainContent_C015_cbTermsOfUse").is(":checked"))
        ) {
            $("#cphMainContent_C015_cbNurseSupport").parent().addClass("parsley-error");
            $("#cphMainContent_C015_cbNurseSupport").parent().parent().addClass("hasError");
            $(".unsub-checkbox").removeClass("hasError");
            $(".unsub-checkbox").addClass("hasError");
            $(".checkboxLabel").hide();
        }
        else {
            $("#cphMainContent_C015_cbNurseSupport").parent().removeClass("parsley-error");
            $("#cphMainContent_C015_cbNurseSupport").parent().parent().removeClass("hasError");
            $(".unsub-checkbox").removeClass("hasError");
            $(".checkboxLabel").show();
        }
    });
    $("#cphMainContent_C015_cbNurseSupport").change(function () {
        $(".contactSubsError").html("");
        $("#cphMainContent_C015_cbTermsOfUse").parent().removeClass("parsley-error");
        $("#cphMainContent_C015_cbTermsOfUse").parent().parent().removeClass("hasError");
        $("#cphMainContent_C015_cbNurseSupport").parent().removeClass("parsley-error");
        $("#cphMainContent_C015_cbNurseSupport").parent().parent().removeClass("hasError");
        $(".unsub-checkbox").removeClass("hasError");
        $(".checkboxLabel").show();
    });
    $("#cphMainContent_C015_cbTermsOfUse").change(function () {
        $(".contactSubsError").html("");
        $("#cphMainContent_C015_cbTermsOfUse").parent().removeClass("parsley-error");
        $("#cphMainContent_C015_cbTermsOfUse").parent().parent().removeClass("hasError");
        $("#cphMainContent_C015_cbNurseSupport").parent().removeClass("parsley-error");
        $("#cphMainContent_C015_cbNurseSupport").parent().parent().removeClass("hasError");
        $(".unsub-checkbox").removeClass("hasError");
        $(".checkboxLabel").show();
    });
    resizeCarouselHolder();
    $(window).on("resize", function() {
        resizeCarouselHolder();
    });

    $(".indication-bg .slick-target").slick({
        infinite: true,
        slidesToShow: 5,
        slidesToScroll: 1
    });

    $(".you-i-carousel").slick({
        infinite: true,
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: false,
        dots: true,
        autoplay: true,
        autoplaySpeed: 4e3,
        speed: 500
    });
    $(".icon-hover").hover(function () {
        $(".learn-more-text").slideDown("fast");
    }, function () {
        $(".learn-more-text").hide();
    }
    );
    $(".categories-filter .catTittle, .cat-list p, .item-list .has-sub-menu p").on("click", function() {
        var self = $(this), icon = self.find("i"), parent = self.parent(), sub_menu = self.next(), sub_menu_height = sub_menu.height(), mob_menu_opened = $(".mob-menu-block.opened").length, mob_side_nav_visible = $(".categories-filter .catTittle:visible").length;
        if (!mob_side_nav_visible && !mob_menu_opened) {
            return;
        }
        if (parent.hasClass("has-sub-menu")) {
            closeOtherNavItems(self, 1);
        } else {
            closeOtherNavItems(self, 0);
        }
        if (parent.hasClass("opened")) {
            parent.removeClass("opened");
            icon.html("+");
            sub_menu.animate({
                height: 0
            });
            setTimeout(function() {
                self.css({
                    "box-shadow": "none"
                });
            }, 300);
        } else {
            sub_menu_height = getSubMenuHeight(sub_menu);
            sub_menu.animate({
                height: sub_menu_height
            }, function() {
                sub_menu.css({
                    height: "auto"
                });
            });
            setTimeout(function() {
                self.css({
                    "box-shadow": "0 2px 3px #a6a6a6"
                });
            }, 300);
            parent.addClass("opened");
            icon.html("-");
        }
    });
    $(".hambBlock .hamburger, .mob-menu-block .close-menu").on("click", function() {
        var menu_block = $(".mob-menu-block"), body = $("body");
        if (menu_block.hasClass("opened")) {
            body.css("overflow", "visible");
            menu_block.removeClass("opened");
            setTimeout(function() {
                menu_block.removeClass("open-transition");
            }, 300);
        } else {
            body.css("overflow", "hidden");
            setLastMenuItemHeight();
            menu_block.addClass("opened open-transition");
        }
    });
    $(".tabsBlock .tab-header a").on("click", function(e) {
        e.preventDefault();
        var self = $(this), self_parent = self.parent(), tab_header = self_parent.parent(), parents = tab_header.find("> div"), tabs_block = tab_header.parent(), self_number = self.attr("href").replace("#", ""), tabs_content = tabs_block.find(".tab-content"), tab_content = tabs_block.find(".tab-content." + self_number);
        parents.removeClass("active");
        self_parent.addClass("active");
        tabs_content.hide();
        tab_content.show();
    });

    var urlPoped = false;
    //$(".tabsBlock .tab-header a").on("click", function (e) {
    //    e.preventDefault();

    //    var pageUrl = location.href.toString().split(window.location.host)[1].toLowerCase();
    //    var pageQry = pageUrl.split("?")[1];
    //    if (typeof pageQry !== 'undefined') { pageUrl = pageUrl.split("?")[0]; }

    //    var self = $(this), self_parent = self.parent(), tab_header = self_parent.parent(), parents = tab_header.find("> div"), tabs_block = tab_header.parent(), self_number = self.attr("href").replace("#", ""), tabs_content = tabs_block.find(".tab-content"), tab_content = tabs_block.find(".tab-content." + self_number);
    //    var element = $(e.target)[0];
    //    if (element.classList.contains("access")) {
    //      //  $(document).prop('title', 'Enroll in YOU&I\u2122 Patient Access Support | IMBRUVICA\u00AE (ibrutinib)');
    //      //  $('meta[name=description]').attr('content', 'Enroll in the YOU&I\u2122 IMBRUVICA\u00AE patient support program that provides info on access, affordability & nurse support. See full prescribing & safety info.');
    //        if (!urlPoped && history.pushState) {
    //            if (pageQry != undefined) {
    //                history.pushState("access-support", "", "/patient-support/access-support?" + pageQry);
    //            }
    //            else {
    //                history.pushState("access-support", "", "/patient-support/access-support");
    //            }
    //        }

    //        loadAjaxTabContent('/tab-pages/access-support', 1, function () { registerYouandIEvents(); });
    //        urlPoped = false;
    //    }
    //    else if (element.classList.contains("affordability")) {
    //     //   $(document).prop('title', 'Cost Support | IMBRUVICA\u00AE (ibrutinib)');
    //     //   $('meta[name=description]').attr('content', 'Learn about IMBRUVICA\u00AE cost support and affordability and the  YOU&I\u2122 patient support program. See full prescribing & safety information.');
    //        if (!urlPoped && history.pushState) {
    //            if (pageQry != undefined) {
    //                history.pushState("cost-support", "", "/patient-support/cost-support?" + pageQry);
    //            }
    //            else {
    //                history.pushState("cost-support", "", "/patient-support/cost-support");
    //            }
    //        }

    //        loadAjaxTabContent('/tab-pages/cost-support', 2, function () { registerYouandIEvents(); });
    //        urlPoped = false;
    //    }
    //    else if (element.classList.contains("support")) {
    //     //   $(document).prop('title', 'Nurse Support | IMBRUVICA\u00AE (ibrutinib)');
    //      //  $('meta[name=description]').attr('content', 'Nurses can help answer questions about IMBRUVICA\u00AE, including how to talk to your loved ones & understanding CLL, MCL or WM. See full prescribing & safety info.');
    //        if (!urlPoped && history.pushState) {
    //            if (pageQry != undefined) {
    //                history.pushState("nurse-support", "", "/patient-support/nurse-support?" + pageQry);
    //            }
    //            else {
    //                history.pushState("nurse-support", "", "/patient-support/nurse-support");
    //            }
    //        }

    //        loadAjaxTabContent('/tab-pages/nurse-call-support', 3, function () { registerYouandIEvents(); });
    //        urlPoped = false;
    //    }
    //    else if (self.attr('href') == '#tab1' && (thepageUrl.indexOf("cll-events") > 0 || thepageUrl.indexOf("patient-resources")) > 0) {

    //      //  $(document).prop('title', 'IMBRUVICA\u00AE (ibrutinib) Patient Resources | CLL');
    //      //  $('meta[name=description]').attr('content', 'Find patient resources and support for CLL as well as helpful tips for talking to your doctor. See full prescribing & safety info.');
    //        if (!urlPoped && history.pushState) {
    //            if (pageQry != undefined) {
    //                history.pushState("patient-resources", "", "/cll/patient-resources?" + pageQry);
    //            }
    //            else {
    //                history.pushState("patient-resources", "", "/cll/patient-resources");
    //            }
    //        }

    //        //loadAjaxTabContent('/tab-pages/cll---resources-support-for-patients-with-cll', 1, function () { reRegisterCllEvents(); });
    //        urlPoped = false;
    //    }
    //    else if (self.attr('href') == '#tab2' && (thepageUrl.indexOf("cll-events") > 0 || thepageUrl.indexOf("patient-resources") > 0 )) {

    //       // $(document).prop('title', 'Chronic Lymphocytic Leukemia Events | IMBRUVICA\u00AE (ibrutinib) ');
    //      //  $('meta[name=description]').attr('content', 'Explore upcoming events for chronic lymphocytic leukemia for patients and caregivers and join the treatment discussion. ');
    //        if (!urlPoped && history.pushState) {
    //            if (pageQry != undefined) {
    //                history.pushState("cell-events", "", "/cll/patient-resources/cll-events?" + pageQry);
    //            }
    //            else {
    //                history.pushState("cell-events", "", "/cll/patient-resources/cll-events");
    //            }
    //        }

    //        //loadAjaxTabContent('/tab-pages/cll---ambassador-program', 2);
    //        urlPoped = false;
    //    }

    //});

    window.addEventListener("popstate", function (e) {

        var pageUrl = location.href.toString().split(window.location.host)[1].toLowerCase();

        if (pageUrl == "/patient-support/access-support" || pageUrl == "/you-i-support") {
            urlPoped = true;
            $("[href=#tab1]").click();
        }
        else if (pageUrl == "/patient-support/cost-support") {
            urlPoped = true;
            $("[href=#tab2]").click();
        }
        else if (pageUrl == "/patient-support/nurse-support") {
            urlPoped = true;
            $("[href=#tab3]").click();
        }
        else if (pageUrl == "/cll/patient-resources") {
            urlPoped = true;
            $("[href=#tab1]").click();
        }
        else if (pageUrl == "/cll/patient-resources/cll-events") {
            urlPoped = true;
            $("[href=#tab2]").click();
        }
    });


    // setting tabs on customer support and resources pages
    var thepageUrl = location.href.toString().split(window.location.host)[1].toLowerCase();

    if (thepageUrl.indexOf("access-support") > 0 || thepageUrl == "/you-i-support") {
        urlPoped = true;
        $("[href=#tab1]").click()
    }
    else if (thepageUrl.indexOf("cost-support") > 0) {
        urlPoped = true;
        $("[href=#tab2]").click()
    }
    else if (thepageUrl.indexOf("nurse-support") > 0) {
        urlPoped = true;
        $("[href=#tab3]").click()
    }
    else if (thepageUrl.indexOf("cll-events") > 0) {
        urlPoped = true;
        $("[href=#tab2]").click()
    }
    else if (thepageUrl.indexOf("patient-resources") > 0) {
        urlPoped = true;
        $("[href=#tab1]").click()
    }

    
    

    $(".content-toggle-1").on("click", function(e) {
        e.preventDefault();
        $(this).addClass("active");
        $(".content-toggle-2").removeClass("active");
        $(".content-1").addClass("active");
        $(".content-2").removeClass("active");
    });
    $(".content-toggle-2").on("click", function(e) {
        e.preventDefault();
        $(this).addClass("active");
        $(".content-toggle-1").removeClass("active");
        $(".content-2").addClass("active");
        $(".content-1").removeClass("active");
    });
    subNavIndications.each(function() {
        var self = $(this), indications = self.find(".indications");
        if (indications.length > 1) {
            self.parent().find(".left-arrow-hit-area").show();
            self.parent().find(".right-arrow-hit-area").show();
            self.parent().find(".indicators").show();
            for (var i = 0, len = indications.length; i < len; i++) {
                if (i === 0) {
                    self.parent().find(".indicators").append('<span data-slide="' + i + '" class="active">');
                } else {
                    self.parent().find(".indicators").append('<span data-slide="' + i + '" >');
                }
            }
        }
    });


    setMobileMenuItem();
    
    

   

    function findPos(obj) {
        var curleft = 0, curtop = 0;
        if (obj.offsetParent) {
            do {
                curleft += obj.offsetLeft;
                curtop += obj.offsetTop;
            } while (obj = obj.offsetParent);
            return {
                left: curleft,
                top: curtop
            };
        }
    }
    var floatingIsi = $("#floatingIsi"), isi = $("#isi"), isiPos = findPos(isi.find(".breakpoint")[0]);
    var debounce;
    function debounceFn() {
        clearTimeout(debounce);
        debounce = setTimeout(function() {
            if (window.pageYOffset + window.innerHeight > isiPos.top) {
                floatingIsi.hide();
            } else {
                floatingIsi.show();
            }
            isiPos = findPos(isi.find(".breakpoint")[0]);
        }, 250);
    }
    function showHideIsi() {
        if (is_mobile()) {
            debounceFn();
        } else {
            if (window.pageYOffset + window.innerHeight > isiPos.top) {
                floatingIsi.hide();
            } else {
                floatingIsi.show();
            }
            isiPos = findPos(isi.find(".breakpoint")[0]);
        }
    }
    $(window).scroll(function(e) {
        showHideIsi();
    });
    showHideIsi();
    setTimeout(function() {
        isiPos = findPos(isi.find(".breakpoint")[0]);
        showHideIsi();
    }, 250);
    floatingIsi.find(".wrapper").append(isi.html());
    floatingIsi.on("click", ".toggle", function() {
        var toggleFn = function(idx, className) {
            if (className === "open") {
                floatingIsi.find(".toggle").html("+");
                floatingIsi.find(".wrapper").scrollTop(0).css("overflow", "hidden");
                $.scrollLock(false);
            } else {
                floatingIsi.find(".toggle").html("-");
                floatingIsi.find(".wrapper").css("overflow", "auto");
                $.scrollLock(true);
            }
            return "open";
        };
        floatingIsi.toggleClass(toggleFn);
    });
    var isiOpens = 0;
    $(".openFloatingIsi").on("click", function(e) {
        e.preventDefault();
        if (isiOpens) {
            return 0;
        } else {
            isiOpens = 1;
        }
        var floatIsi = $("#floatingIsi"), isiToggle = floatIsi.find(".toggle"), isiWrapper = floatIsi.find(".wrapper");
        if (floatIsi.hasClass("open")) {
            isiToggle.html("+");
            isiWrapper.scrollTop(0).css("overflow", "hidden");
            floatIsi.removeClass("open");
            $.scrollLock(false);
        } else {
            isiToggle.html("-");
            isiWrapper.css("overflow", "auto");
            floatIsi.addClass("open");
            $.scrollLock(true);
        }
        isiOpens = 0;
    });
    
    var regForm = $("#form1"), subscForm = $("#form1");
    if (regForm.length > 0) {
        regForm.parsley();
    }
    if (subscForm.length > 0) {
        subscForm.parsley();
    }
    window.Parsley.addValidator("validDate", {
        requirementType: "string",
        validateString: function (value, requirement) {
            var regex_date = /^(0[1-9]|1[012])[\/](0[1-9]|[12][0-9]|3[01])[\/](19|20)\d\d$/;
            if (!regex_date.test(value))
            {
                return false;
            }
            var parts = value.split("/");
            var month = parseInt(parts[0], 10);
            var day = parseInt(parts[1], 10);
            var year = parseInt(parts[2], 10);
            if (year < 1e3 || year > 3e3 || month === 0 || month > 12) { return false; }
            var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (year % 400 === 0 || year % 100 !== 0 && year % 4 === 0)
            { monthLength[1] = 29; }
            return day > 0 && day <= monthLength[month - 1];
        },
        messages:
        { en: "Must be valid MM/DD/YYYY" }
    });
    window.Parsley.on("field:error", function() {
        var self = this.$element;
        self.closest(".columns").addClass("hasError");
        $(".errorTextContainer").fadeIn();
    });
    window.Parsley.on("field:success", function() {
        var self = this.$element;
        self.closest(".columns").removeClass("hasError");
    });
    $(".efficacy-content .indication, .safety-content .indication").on("click", function(e) {
        e.preventDefault();
        var self = $(this), id = self.attr("id").replace("-toggle", "");
        $('[id*="-toggle"]').removeClass("focus");
        self.addClass("focus");
        $("body").attr("class", id);
        $(".indication-content").hide();
        $("." + id + "-content").show();
    });
    $("a.show-lso").click(showIsoPopup);
    $(".close-lso").click(function() {
        close_lso();
    });
    var mySwipe = Swipe(document.getElementById("slider"), {
        callback: swipeCallback
    });
    var swipeIndex = 0;
    $("#marquee .indicators").on("click", "span", function() {
        var page = $(this).data("page");
        mySwipe.slide(page - 1);
        $("#marquee .indicators span.active").removeClass("active");
        $(this).addClass("active");
    });
    $("#marquee .prev").click(function() {
        if (swipeIndex === 0) {
            mySwipe.slide(2);
        } else {
            mySwipe.prev();
        }
        $("#marquee .indicators span.active").removeClass("active");
        $("#marquee .indicators span").eq(swipeIndex).addClass("active");
    });
    $("#marquee .next").click(function(e) {
        if (swipeIndex == 2) {
            mySwipe.slide(0);
        } else {
            mySwipe.next();
        }
        $("#marquee .indicators span.active").removeClass("active");
        $("#marquee .indicators span").eq(swipeIndex).addClass("active");
    });
    function swipeCallback(index) {
        swipeIndex = index;
    }

    if (is_mobile()) {
        $(".video-button").removeAttr("data-reveal-id").attr("href", "https://s3-us-west-2.amazonaws.com/pcyc-website-assets/imbruvica/IMB_BillandDianeTestimonial_v32.mp4");
        var vidThumbs = $(".videoThumb"), vidThumbsLength = vidThumbs.length;
        if (vidThumbsLength > 0) {
            vidThumbs.each(function () {
                var self = $(this), videoWrapper = self.find(".videoWrapper"), link = self.find("a"), section = self.find("section");
                self.prepend(videoWrapper);
                link.remove();
                section.remove();
            });
        }
    }

    // Added to capture the video done button on mobile devices and close the video overlay.
    //function closeVideoOverlay() {
    //    var vidBG = $(".reveal-modal-bg");
    //    vidBg.hide();
    //    vidBg.next("div").remove();
    //    resetVideo();
    //}
    //function resetVideo() {
    //    var videoPlayer = $("#video_player_stories").get(0);
    //    videoPlayer.currentTime = 0;
    //    videoPlayer.load();
    //}
    //var is_iPad = navigator.userAgent.match(/iPad/i) != null;
    //var is_Android = navigator.userAgent.toLowerCase().match(/android/i) != null;
    //if (is_mobile()) {
    //    var videoPlayer = $("#video_player_stories").get(0);
    //    if (!is_iPad) {
    //        videoPlayer.addEventListener('ended', closeVideoOverlay);
    //        $(".video-button").removeAttr("data-reveal-id");
    //    }
    //    else if (is_iPad) {
    //        videoPlayer.addEventListener('ended', resetVideo);
    //    }
        
    //    var vidThumbs = $(".videoThumb"), vidThumbsLength = vidThumbs.length;
    //    if (vidThumbsLength > 0) {
    //        vidThumbs.each(function() {
    //            var self = $(this), videoWrapper = self.find(".videoWrapper"), link = self.find("a"), section = self.find("section");
    //            self.prepend(videoWrapper);
    //            link.remove();
    //            section.remove();
    //        });
    //    }
    //}
    //else if (is_Android) {
    //    videoPlayer.addEventListener('ended', resetVideo);
    //    $(".video-button").removeAttr("data-reveal-id");
    //}

    // Reset video to begining when closed. Performs a pause - load for each video element.
    $(".close-reveal-modal").on("click touch", function () {
        $('video').each(function () {
            $(this).get(0).pause();
            $(this).get(0).load();
        });
    });

    // Close videos if ESC key is pressed.
    $(document).keyup(function (e) {
        if (e.keyCode === 27) $(".close-reveal-modal").click();   // esc
    });

    // Close videos if modal bg is clicked
    $(document).click(function (e) {
        if (e.target === $('.reveal-modal-bg')[0]) {
            $(".close-reveal-modal").click();
        }
    });

    $(".readMoreBtn").on("click touch", function (e) {
        e.preventDefault();
        var self = $(this), btn = self.find("p"), moreBlock = self.prev(), moreBlockHeight, currentText = "";
        if (btn.hasClass("close")) {
            btn.removeClass("close");
            currentText = btn.html(); console.log(currentText);
            currentText = currentText.replace(/less/i, 'more');
            $(".tooltip").fadeOut(150);
            moreBlock.animate({
                height: 0
            }, function() {
                btn.html(currentText);
            });
        } else {
            btn.addClass("close");
            moreBlock.css("height", "auto");
            moreBlockHeight = moreBlock.height();
            moreBlock.css("height", 0);
            currentText = btn.html(); console.log(currentText);
            currentText = currentText.replace(/more/i, 'less');
            moreBlock.animate({
                height: moreBlockHeight
            }, function() {
                btn.html(currentText);
            });
        }
    });
    $(".pageShare").click(function(e) {
        e.preventDefault();
        var pageUrl = window.location.href;
        window.location.href = "mailto:?body=" + pageUrl;
    });
    $(".btn-dropdown").click(function() {
        var self = $(this);
        if (self.hasClass("opened")) {
            self.removeClass("opened");
        } else {
            self.addClass("opened");
        }
    });
    $(".labelText").click(function(e) {
        e.preventDefault();
        var self = $(this), check = self.siblings("span.custom.radio");
        //var self = $(this), check = self.prev();
        check.click();
    });
    if (winW > 768) {} else {
        var catNavTop = $(".logo-holder:visible").outerHeight(true) + $(".top-nav.show-for-small").outerHeight(true);
        $(".cat-nav").css("top", catNavTop);
    }
    $(window).resize(function() {
        var winW = $(window).width();
        var catNavTop = $(".logo-holder:visible").outerHeight(true) + $(".top-nav.show-for-small").outerHeight(true);
        if (winW > 768) {
            catNavTop = 0;
            if (!is_mobile()) {
                resetSideNav(0);
            }
        } else {
            if (!is_mobile()) {
                resetSideNav(1);
            }
        }
        $(".cat-nav").css("top", catNavTop);
        setLastMenuItemHeight();
    });
    if (is_mobile()) {
        window.onorientationchange = function(e) {
            var orientation = window.orientation, winW = $(window).width();
            if (orientation === 0) {
                resetSideNav(1);
            } else if (orientation === 90) {
                if (winW > 767) {
                    resetSideNav(0);
                } else {
                    resetSideNav(1);
                }
            } else if (orientation === -90) {
                if (winW > 767) {
                    resetSideNav(0);
                } else {
                    resetSideNav(1);
                }
            } else if (orientation === 180) {
                resetSideNav(1);
            }
            setLastMenuItemHeight();
        };
    }
    function is_ie_11() {
        if (!window.ActiveXObject && "ActiveXObject") {
            return 1;
        } else {
            return 0;
        }
    }
    function is_firefox() {
        return $(".firefox").length;
    }
    function is_mobile() {
        return $(".mobile").length;
    }
    
    
    function setColExtWidth() {
        var winW = $(window).width(), col_ext = $("main .column-extension-right"), col_ext_width, col_main = $("main"), col_main_offset = col_main.offset().left, col_main_width = col_main.width();
        col_ext_width = winW - col_main_offset - col_main_width;
        col_ext.css("width", col_ext_width);
    }
    function resetSideNav(mob) {
        var cat_filter = $(".categories-filter"), cat_tittle = cat_filter.find(".catTittle"), cat_ico_item = cat_tittle.find(".ico-item"), cat_list = $(".cat-list"), cat_list_li = cat_list.find("> li"), cat_list_li_p = cat_list_li.find("> p"), cat_sub_menu = $(".cat-sub-menu");
        if (mob) {
            cat_filter.removeClass("opened");
            cat_tittle.css({
                "box-shadow": "none"
            });
            cat_ico_item.html("+");
            cat_list.height(0);
            cat_list_li_p.css("box-shadow", "none");
            cat_sub_menu.height(0);
        } else {
            cat_filter.removeClass("opened");
            cat_tittle.css("box-shadow", "none");
            cat_sub_menu.height("auto");
            cat_list.height("auto");
            cat_list_li.removeClass("opened");
            cat_list_li_p.css("box-shadow", "none");
        }
    }
    function getSubMenuHeight(sub_menu) {
        sub_menu.css("height", "auto");
        var h = sub_menu.height();
        sub_menu.css("height", 0);
        return h;
    }
    function closeOtherNavItems(self, mob) {
        if (self === 0) {
            self = $("");
        }
        var parent = self.parent(), i = self.find("i"), other_li = $(".cat-list li").not(parent), other_p = $(".cat-list p").not(self), other_i = $(".cat-list i").not(i), sub_menu = $(".cat-sub-menu");
        if (mob) {
            other_li = $(".item-list li").not(parent);
            other_p = $(".item-list p").not(self);
            other_i = $(".item-list i").not(i);
            sub_menu = $(".item-sub-menu");
        }
        other_li.removeClass("opened");
        other_i.html("+");
        sub_menu.animate({
            height: 0
        }, function() {
            other_p.css({
                "box-shadow": "none"
            });
        });
    }
    function setLastMenuItemHeight() {
        var window_height = $(window).height(), mob_menu_row_height = $(".mob-menu-block > .row").height();
        var mob_menu_menu_height = $(".mob-menu-block .mob-menu").height(), floating_isi_height = $("#floatingIsi").outerHeight();
        var last_item = $(".item-list li:last"), last_item_a = last_item.find("a");
        var last_item_padding_bottom = parseInt(last_item_a.css("padding-bottom").replace("px", ""));
        var last_item_new_padding = ((window_height - (mob_menu_menu_height - last_item_padding_bottom)) + (14 + floating_isi_height));

        last_item_new_padding = (14 + floating_isi_height);
        last_item_a.css("padding-bottom", last_item_new_padding);
    }
});

function setMobileMenuItem() {

    //$(".section-nav-btns").addClass("show-for-medium-up");

    $(".cll-item a").removeClass("active");
    $(".mcl-item a").removeClass("active");
    $(".wm-item a").removeClass("active");
    $(".mzl-item a").removeClass("active");
    $(".cgvhd-item a").removeClass("active");

    var loc = window.location.pathname.replace(/\/$/, '');

    if (loc.startsWith("/cll")) {
        $(".cll-item a").addClass("active");
    }
    else if (loc.startsWith("/mcl")) {
        $(".mcl-item a").addClass("active");
    }
    else if (loc.startsWith("/wm")) {
        $(".wm-item a").addClass("active");
    }
    else if (loc.startsWith("/mzl")) {
        $(".mzl-item a").addClass("active");
    }
    else if (loc.startsWith("/cgvhd")) {
        $(".cgvhd-item a").addClass("active");
    }
}

function showIsoPopup(e) {
    var self = $(this), url = self.attr("href"), target = self.attr("target"), lso_type = self.attr("data-lso-type");
    if (target === "_blank") {
        if ($("#lso:visible").length) {
            close_lso();
            return 1;
        }
        e.preventDefault();
        open_lso(lso_type, url);
    }
}

// Edits 
function open_lso(health, url) {
    var lso, btns;

    if (health == 1) {
        lso = $("#lso");
        btns = lso.find(".button-1, .button-5");
    } 
    else if (health == 2) {
        lso = $("#lso-janssen");
        btns = lso.find(".button-1, .button-5");

        // Uncheck the US checkbox
        var cbUS = $("#cphMainContent_C012_cbUS")[0];
        cbUS.checked = false;
        var custCBUS = $(".janssen-click");
        custCBUS.removeClass("checked");
    }
    else if (health == 3) {
        lso = $("#lso-popup");
        btns = lso.find(".button-1");
    }
    else {
        lso = $("#lso-healthcare");
        btns = lso.find(".button-1, .button-5");
    }

    $.scrollLock(true);
    lso.fadeIn();
    btns.unbind("click").click(function () {        
        var self = $(this), self_action = self.attr("data-action");
        
        if (self_action === "cancel") {
            close_lso();
        } else {
            window.open(url, "_blank");
            close_lso();
        }
    });
}

function close_lso() {
    $("#lso, #lso-healthcare, #lso-janssen, #lso-popup").fadeOut();
    $.scrollLock(false);
}

function loadAjaxTabContent(url, tab, callback) {

    $('.tab1').html('');
    $('.tab2').html('');
    $('.tab3').html('');
    $('.tab4').html('');
    $('.tab5').html('');

    var tab = '.tab' + tab;

    $.get(url, function (data) {
        var parsedHtml = $.parseHTML(data);
        var content = $(parsedHtml).find('.sfContentBlock');

        $(tab).html(content);

        if (typeof (callback) == "function") {
            callback();
        }

        var title = $(data).filter("title").text().trim();
        var description = $(data).filter("meta[name=description]").attr("content").trim();

        $(document).prop('title', title);
        $('meta[name=description]').attr('content', description);
        $("a.show-lso").click(showIsoPopup);
    });
}

function is_mobile() {
    return $(".mobile").length;
}

if (is_mobile()) {
    var links = $("a.videoLink");
    var winW = $(window).width();  // Added as Winw as undefined in mobile
    if (links.length > 0) {
        links.each(function() {
            var self = $(this),
                vidContainer = self.parent(),
                vidId = self.attr("data-reveal-id"),
                videoWrapper = $("#" + vidId).find(".videoWrapper"),
                section = $("section#" + vidId);
            var newVWrap = videoWrapper.clone();
            if (winW >= 769 && winW < 1025) {
                newVWrap.css({
                    padding: "0px 0 48%",
                    height: "100%",
                    width: "100%",
                    top: "0px"
                });
            }
            if (winW < 769) {
                newVWrap.css({
                    padding: "30px 0 48%",
                    height: "100%",
                    width: "100%"
                });
            }
            newVWrap.prependTo(vidContainer);
            self.remove();
        });
    }
}

$(document).ready(function() {
    $('a.tabs div').click(function() {
        var tab_id = $(this).attr('data-tab');

        $('a.tabs div').removeClass('current');
        $('.tab-content').removeClass('current');

        $(this).addClass('current');
        $("#" + tab_id).addClass('current');
    })

    $(".tab-1-calendar-container .faq-close-up").click(function() {
        $(".tab-1-calendar-container .faq-panel").toggle();
        $("html, body").animate({ scrollTop: $(".tab-1-calendar-container").offset().top });
        var accToggle = document.getElementsByClassName("faq-accordion")[0];
        accToggle.classList.toggle("active");
        $(".tab-1-calendar-container .large-12").removeClass("tab-border-bottom");
    });

    $(".tab-2-calendar-container .faq-close-up").click(function() {
        $(".tab-2-calendar-container .faq-panel").toggle();
        $("html, body").animate({ scrollTop: $(".tab-2-calendar-container").offset().top });
        var accToggle = document.getElementsByClassName("faq-accordion")[1];
        accToggle.classList.toggle("active");
        $(".tab-2-calendar-container .large-12").removeClass("tab-border-bottom");
    });

    $(".how-take-container .faq-close-up").click(function() {
        $(".how-take-container .faq-panel").toggle();
        $("html, body").animate({ scrollTop: $(".how-take-container").offset().top });
        var accToggle = document.getElementsByClassName("faq-accordion")[2];
        accToggle.classList.toggle("active");
        $(".how-take-container .large-12").removeClass("tab-border-bottom");
    });

    window.onload = function () {
        $('.one-pill-popup').animate({ "right": "0" }, 800);
        $('.popup-desktop #close-popup').click(function () {
            $('.popup-desktop.one-pill-popup').hide();
        });
        $('.popup-mobile #close-popup').click(function () {
            $('.popup-mobile.one-pill-popup').hide();
            // document.getElementById('cll-mob-doa').style.margin = 'auto';
            var catNavTop = $(".main-header.show-for-small.mob-header").outerHeight(true);
            $(".cat-nav").css("top", catNavTop);
            var cllMobTop = $(".cat-nav").outerHeight(true);
            $("#cll-mob-doa").css("margin-top", cllMobTop);
        });

        // Illuminate flyout
        $('.imbruvica-flyout-desktop.illuminate-flyout').animate({ "top": "0px" }, 800);
        $('.imbruvica-flyout-desktop.illuminate-flyout #illuminate-flyout-close').click(function () {
            $('.imbruvica-flyout-desktop.illuminate-flyout').hide();
        });
        $('.imbruvica-flyout-mobile.illuminate-flyout').animate({ "top": "0px" }, 600);
        $('.imbruvica-flyout-mobile.illuminate-flyout #illuminate-flyout-close').click(function () {
            $('.imbruvica-flyout-mobile.illuminate-flyout').hide();
        });
    }

    $(window).on("load resize", function () {
        if ($(window).width() < 360) {
            if (document.getElementsByClassName('popup-ad-copy')[0] != undefined) {
                document.getElementsByClassName('popup-ad-copy')[0].style.paddingLeft = "10px";
            }
            if (document.getElementsByClassName('popup-button button-1')[0] != undefined) {
                document.getElementsByClassName('popup-button button-1')[0].style.left = "15px";
            }
        }
        else {
            if (document.getElementsByClassName('popup-ad-copy')[0] != undefined) {
                document.getElementsByClassName('popup-ad-copy')[0].style.paddingLeft = "30px";
            }
            if (document.getElementsByClassName('popup-button button-1')[0] != undefined) {
                document.getElementsByClassName('popup-button button-1')[0].style.left = "34px";
            }
        }
        if ($(window).width() < 420) {
            if (document.getElementsByClassName('popup-code')[0] != undefined) {
                document.getElementsByClassName('popup-code')[0].style.top = "315px";
            }
            if (document.getElementsByClassName('one-pill-popup')[0] != undefined) {
                document.getElementsByClassName('one-pill-popup')[0].style.height = "340px";
            }
            if (document.getElementsByClassName('popup-copy')[0] != undefined) {
                document.getElementsByClassName('popup-copy')[0].style.height = "127px";
            }
        }
        else {
            if (document.getElementsByClassName('popup-code')[0] != undefined) {
                document.getElementsByClassName('popup-code')[0].style.top = "291px";
            }
            if (document.getElementsByClassName('one-pill-popup')[0] != undefined) {
                document.getElementsByClassName('one-pill-popup')[0].style.height = "330px";
            }
            if (document.getElementsByClassName('popup-copy')[0] != undefined) {
                document.getElementsByClassName('popup-copy')[0].style.height = "117px";
            }
        }
    });
})

var acc1 = document.getElementById("faq-panel-1");
var acc2 = document.getElementById("faq-panel-2");
var acc3 = document.getElementById("faq-panel-3");

if (acc1 != undefined) {
    acc1.onclick = function () {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
            $("html, body").animate({ scrollTop: $(".tab-1-calendar-container").offset().top });
            $(".tab-1-calendar-container .large-12").removeClass("tab-border-bottom");
        } else {
            panel.style.display = "block";
            $("html, body").animate({ scrollTop: $("#faq-panel-1 .faq-close").offset().top });
            $(".tab-1-calendar-container .large-12").addClass("tab-border-bottom");
        }
    }
}

if (acc2 != undefined) {
    acc2.onclick = function () {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
            $("html, body").animate({ scrollTop: $(".tab-2-calendar-container").offset().top });
            $(".tab-2-calendar-container .large-12").removeClass("tab-border-bottom");
        } else {
            panel.style.display = "block";
            $("html, body").animate({ scrollTop: $("#faq-panel-2 .faq-close").offset().top });
            $(".tab-2-calendar-container .large-12").addClass("tab-border-bottom");

        }
    }
}

if (acc3 != undefined) {
    acc3.onclick = function () {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
            $("html, body").animate({ scrollTop: $(".how-take-container").offset().top });
            $(".how-take-container .large-12").removeClass("tab-border-bottom");
        } else {
            panel.style.display = "block";
            $("html, body").animate({ scrollTop: $("#faq-panel-3 .faq-close").offset().top });
            $(".how-take-container .large-12").addClass("tab-border-bottom");

        }
    }
}

$('#see-how-btn').click(function () {
    $('a#ind-tab-1 div').removeClass('current');
    $('#tab-1.tab-content').removeClass('current');

    $('a#ind-tab-2 div').addClass('current');
    $('#tab-2.tab-content').addClass('current');

    // Scroll to the video player
    var jump = $('#watch_video_target');
    var new_pos = jump.offset();

    $('#bodyTag').animate({ scrollTop: new_pos.top }, 200);
})
$('#see-how-btn2').click(function () {
    $('a#ind-tab-1 div').removeClass('current');
    $('#tab-1.tab-content').removeClass('current');

    $('a#ind-tab-2 div').addClass('current');
    $('#tab-2.tab-content').addClass('current');

    // Scroll to the video player
    var jump = $('#watch_video_target');
    var new_pos = jump.offset();

    $('#bodyTag').animate({ scrollTop: new_pos.top }, 200);
})
$('#how-btn').click(function () {
    $('a#ind-tab-1 div').removeClass('current');
    $('#tab-1.tab-content').removeClass('current');

    $('a#ind-tab-2 div').addClass('current');
    $('#tab-2.tab-content').addClass('current');
})
$('#whats-btn').click(function () {
    $('a#ind-tab-2 div').removeClass('current');
    $('#tab-2.tab-content').removeClass('current');

    $('a#ind-tab-1 div').addClass('current');
    $('#tab-1.tab-content').addClass('current');
})
